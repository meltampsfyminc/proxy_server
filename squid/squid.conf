# squid/squid.conf - Allow internet access
http_port 3128

# Define networks
acl localnet src 0.0.0.0/0.0.0.0  # ALLOW ALL - adjust as needed
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8

# Safe ports
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 443         # https
acl Safe_ports port 21          # ftp
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

# ACCESS RULES (CRITICAL - This was blocking everything)
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost
http_access allow localnet  # THIS ALLOWS INTERNET ACCESS
http_access deny all

# DNS settings - ensure Squid can resolve domains
dns_nameservers 8.8.8.8 8.8.4.4
positive_dns_ttl 6 hours
negative_dns_ttl 1 minutes

# Cache settings
cache_dir ufs /var/spool/squid 100 16 256
maximum_object_size 256 MB
minimum_object_size 0 KB

# Logging
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log

# Refresh patterns
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320